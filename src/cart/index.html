<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://code.getmdl.io/1.3.0/material.indigo-blue.min.css"
    />
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <style>
      .empty-cart {
      }
    </style>
    <script type="module">
      import {
        h,
        render,
        signal,
        effect,
      } from 'https://cdn.jsdelivr.net/npm/preact-htm-signals-standalone@0.0.12/+esm';

      import htm from 'https://esm.sh/htm';
      const html = htm.bind(h);

      const cart = signal(
        JSON.parse(localStorage.getItem('shoppingCart') || '[]')
      );

      function updateProductCount(count, id) {
        window.parent.postMessage(
          {
            message: 'cart#updateProductCount',
            payload: { id, count },
          },
          '*'
        );
      }

      function Cart() {
        return html` <ul class="demo-list-control mdl-list">
          ${cart.value.length
            ? cart.value.map(
                (pr) => html`<li class="mdl-list__item">
                  <span class="mdl-list__item-primary-content">
                    <i class="material-icons  mdl-list__item-avatar">person</i>
                    ${pr.title}
                  </span>
                  <span class="mdl-list__item-secondary-action">
                    <div
                      class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label"
                    >
                      <input
                        class="mdl-textfield__input"
                        onBlur=${(e) =>
                          updateProductCount(e.target.value, pr.id)}
                        min="0"
                        max="${pr.stock}"
                        type="number"
                        value="${pr.count}"
                      />
                    </div>
                  </span>
                </li>`
              )
            : html`<div class="empty-cart">
                <span class="material-symbols-outlined">
                  shopping_cart_off
                </span>
              </div>`}
        </ul>`;
      }

      render(html`<${Cart} />`, document.body);
    </script>
  </head>
  <body></body>
</html>
