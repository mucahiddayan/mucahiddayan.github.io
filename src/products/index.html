<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Products</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://code.getmdl.io/1.3.0/material.indigo-blue.min.css"
    />
    <style>
      .products {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
        padding: 10px;
        justify-items: center;
      }

      img {
        height: 200px;
      }

      .mdl-card__media {
        display: flex;
        justify-content: center;
      }
    </style>
    <script type="module">
      import {
        h,
        render,
        signal,
        effect
      } from 'https://cdn.jsdelivr.net/npm/preact-htm-signals-standalone@0.0.12/+esm'

      import htm from 'https://esm.sh/htm'
      const html = htm.bind(h)

      function getProducts() {
        return fetch(`https://dummyjson.com/products?skip=5&limit=10`)
          .then(res => res.json())
          .then(({ products }) => products)
      }

      const products = signal([])

      getProducts().then(prods => (products.value = prods))

      function openProduct(product) {
        window.parent.postMessage(
          { message: 'products#open', payload: { product } },
          '*'
        )
      }

      function Products() {
        return products.value.length
          ? products.value.map(
              pr => html`<div class="demo-card-square mdl-card mdl-shadow--2dp">
                <div
                  class="mdl-card__title mdl-card--expand"
                  data-product-id="${pr?.id}"
                >
                  <h2 class="mdl-card__title-text">${pr?.title}</h2>
                </div>
                <div class="mdl-card__media">
                  <img src="${pr.thumbnail}" />
                </div>
                <div class="mdl-card__supporting-text">${pr?.description}</div>
                <div class="mdl-card__actions mdl-card--border">
                  <a
                    class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect"
                    onClick="${() => openProduct(pr)}"
                  >
                    Details
                  </a>
                </div>
              </div>`
            )
          : html`<div
              id="p2"
              class="mdl-progress mdl-js-progress mdl-progress__indeterminate"
            ></div>`
      }

      render(html`<${Products} />`, document.querySelector('.products'))
    </script>
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  </head>
  <body>
    <div class="products"></div>
  </body>
</html>
